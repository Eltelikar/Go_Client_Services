Данная программа - сервис для добавления постов и комментариев, а также их чтения с применением GraphQL.


### Функционал:
- Возможность писать посты.
	- Возможность запретить оставление комментариев к посту.
-  Возможность писать комментарии.
	- Возможность писать комментарии в ответ к другим комментариям.
	- Комментарии организованы иерархически, позволяя вложенность без ограничений.
	- Длинна текста комментария ограничена до 2000 символов.
- Получение списка всех постов.
- Чтение поста и всех комментариев к нему.
	- Система пагинации позволяет получать комментарии списками.
- Возможность подписаться на канал: подписавшийся пользователь будет получать  уведомления о добавлении новых комментариев асинхронно, без необходимости повторного запроса.
- Хранение данных может быть как в памяти, так и в PostgreSQL. Выбор хранилища определяется config-файлом.
---
### Запуск и тестирование:
Программа запускается в контейнере при помощи `docker-compose`. 
Исполнение команд осуществляется через `Makefile`
По умолчанию, подключение к сервису доступно по адресу `http://localhost:8080`, PostgreSQL доступна через порт `5432`.
Данные настройки можно изменить в файлах: `/configs/config.yml` и `docker-compose.yml`

**Цели Makefile:**
- **`All`: запускается цель `build` и исполняется команда `docker-compose up`**
	- собирается docker-образ и запускается контейнер с программой.
- **`test`: исполняется команда `go test -count=5 ./internal/graph/`**
	- производится запуск тестов по указанной директории, тесты повторяются 5 раз перед выводом результатов.
- **`build`: исполняется команда `docker-compose build`** 
	- собирается docker-образ без запуска контейнера.
- **`clean-build`: запускает цели `clear-build`, `build`, команду `docker-compose up`** 
	- производится очистка существующих образов, сборка нужного образа заново, старт контейнера.
- **`clear-build`: исполняет команду `docker-compose down --rmi all --volumes`**
	- производится остановка всех контейнеров, удаление всех образов, связанных с проектом, а также все созданные тома.
---
### GraphQL Playground
Для ручного тестирования используется GraphQL Playground.
Адрес по умолчанию: `http://localhost:8080/pground`

**Доступные запросы для GraphQL Playground:**
1. **Создание поста:**
	   `title` - Заголовок поста; обязательное, не может быть пустым
	   `content` - Содержание поста; обязательное, не может быть пустым
	   `commentsAllowed` - Разрешение на добавление комментариев; обязательное.
```go
mutation {
  createPost(
    title: "Заголовок поста", 
    content: "Текст поста", 
    commentsAllowed: true/false) {
    id
    title
    content
    commentsAllowed
    createdAt
  }
}
```
2. **Создание комментария к посту:**
	   `postID` - ID поста, к которому оставляется комментарий; обязательное
	   `content` - содержимое комментария; обязательное, не может быть пустым и более 2000 символов
```go
mutation {
  createComment(
    postID: "ID поста к которому оставляется комментарий", 
    content: "Текст комментария") {
    id
    content
    postID
    createdAt
  }
}

```
3. **Создание ответа на комментарий к посту:**
	   Все поля соответствуют созданию обычного комментария. Добавляется поле `parentID`
	   `parentID` - ID родительского комментария.
```go
mutation {
  createComment(
    postID: "ID поста к которому оставляется комментарий", 
    parentID:"ID родительского комментария", 
    content: "Текст комментария") {
    id
    parentID
    content
    postID
    createdAt
  }
}
```
4. **Запрос поста с комментариями:**
	   Используется система пагинации.
	   `id` - ID поста, информацию о котором хотим получить; обязательное
	   `first` -  комментарии в одном списке; обязательное, не может быть меньше 0
	   `after` - ID комментария, после которого начинается формирование списка
	   
```go
query {
  getPost(
    id: "ID поста", 
    first: <количество элементов в одном списке>,
  	after: "ID комментария, после которого начинается список") {
    id
    title
    content
    commentsAllowed
    comments {
      edges {
        cursor
        node {
          id
          parentID
          content
          createdAt
        }
      }
      pageInfo {
        endCursor
        hasNextPage
      }
    }
  }
}
```
5. **Запрос списка всех постов**
```go
query {
  getAllPosts {
    id
    title
    content
    commentsAllowed
  }
}
```
6. **Подписка на пост для получение уведомлений**
		`postID` - ID поста, на который осуществляется подписка
```go
subscription {
  commentsUpdated(
    postID: "ID поста на который осуществляется подписка") {
    id
    postID
    content
  }
}
```